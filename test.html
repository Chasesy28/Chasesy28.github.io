<!doctype html>
<html>
  <head>
    <title>Test</title>
    <link rel="icon" href="/icons/icon-192x192.png">
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cherry+Bomb+One&display=swap" rel="stylesheet">
  </head>
  <body>
    <div class="rain">
      <p>Hello <br> Hello, this thing here is useful.</p>
      <input type="range" step="1" min="1" onchange="updateRain()" id="input" value="15">
    </div>
    <p id="test">15</p>
    <script>
        document.getElementById("test").innerHtml = "Hello";
      </script>
    <div class="ground"></div>
    <script>
       document.addEventListener('DOMContentLoaded', function() {
            const rainContainer = document.querySelector('.rain');
            var dropDensity = 15; // Moved here to be accessible by all functions

            // --- Function to create a single drop ---
            const createDrop = () => {
                const drop = document.createElement('div');
                drop.classList.add('drop');

                // Random horizontal position, delay, and duration
                drop.style.left = `${Math.random() * 100}vw`;
                drop.style.animationDelay = `${Math.random() * 2}s`;
                drop.style.animationDuration = `${0.7 + Math.random() * 0.5}s`;

                // Event Listener for the Splash
                drop.addEventListener('animationiteration', () => {
                    const splash = document.createElement('div');
                    splash.classList.add('splash');
                    splash.style.left = drop.style.left;
                    splash.style.bottom = '5px';
                    rainContainer.appendChild(splash);

                    setTimeout(() => {
                        splash.classList.add('splash-animation');
                    }, 10);

                    splash.addEventListener('animationend', () => {
                        splash.remove();
                    }, { once: true });
                });

                rainContainer.appendChild(drop);
            };

            // --- Function to handle resizing ---
            const handleResize = () => {
              const newNumberOfDrops = Math.floor(window.innerWidth / dropDensity);
                const currentDrops = rainContainer.querySelectorAll('.drop');
                const diff = newNumberOfDrops - currentDrops.length;

                if (diff > 0) {
                    // If the screen got bigger, add more drops
                    for (let i = 0; i < diff; i++) {
                        createDrop();
                    }
                } else if (diff < 0) {
                    // If the screen got smaller, remove some drops
                    for (let i = 0; i < Math.abs(diff); i++) {
                        // Remove the last drop to be less noticeable
                        if (currentDrops[currentDrops.length - 1 - i]) {
                             currentDrops[currentDrops.length - 1 - i].remove();
                        }
                    }
                }
            };
            
            // --- Initial Setup ---
            const initRain = () => {
                const initialNumberOfDrops = Math.floor(window.innerWidth / dropDensity);
                for (let i = 0; i < initialNumberOfDrops; i++) {
                  createDrop();
                }
            };

            initRain();

            // Use the new resize handler
            window.addEventListener('resize', handleResize);
        });
      function updateRain(){
        dropDensity = document.getElementById("input").value;
        testText = document.getElementById("test");
        testText.innerHtml = "String(dropDensity)";
        alert(String(dropDensity));
        handleResize();
      }
    </script>
  </body>
</html>
